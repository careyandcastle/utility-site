<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windows Server 2025 æˆæ¬Šè²»ç”¨è©¦ç®—å·¥å…·</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f7f6; margin: 0; padding: 20px; color: #333; line-height: 1.6; }
        .header { text-align: center; margin-bottom: 20px; color: #0078d4; }
        .container { display: flex; gap: 20px; max-width: 1200px; margin: auto; flex-wrap: wrap; }
        .panel { background: white; padding: 25px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); flex: 1; min-width: 450px; }
        .full-width { flex: 100%; min-width: 100%; margin-top: 10px; }
        
        /* è¡¨å–®å€åŸŸæ¨£å¼ */
        .form-group { margin-bottom: 20px; background: #fff8f0; padding: 15px; border-left: 4px solid #f25022; border-radius: 4px; }
        label { font-weight: bold; display: block; margin-bottom: 8px; }
        input[type="number"] { width: 100px; padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 16px; }
        .hint { font-size: 13px; color: #666; margin-top: 5px; display: block; }
        
        /* ä¸»æ©Ÿå€å¡Šæ¨£å¼ */
        #hosts-container { margin-top: 20px; }
        .host-block { border: 1px solid #e1dfdd; padding: 15px; margin-bottom: 15px; border-radius: 6px; background: #faf9f8; }
        .host-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; font-weight: bold; color: #0078d4; }
        .host-inputs { display: flex; gap: 15px; flex-wrap: wrap; margin-top: 10px; }
        .input-group { display: flex; flex-direction: column; }
        .input-group label { font-size: 14px; font-weight: normal; margin-bottom: 4px; }
        
        /* æŒ‰éˆ•æ¨£å¼ */
        button { background: #0078d4; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 14px; transition: background 0.2s; }
        button:hover { background: #005a9e; }
        .btn-remove { background: #d13438; padding: 6px 12px; }
        .btn-remove:hover { background: #a80000; }
        
        /* çµæœå€åŸŸæ¨£å¼ */
        .result-box { padding: 15px; margin-bottom: 15px; border-radius: 6px; border: 1px solid #ddd; }
        .cost-title { font-size: 15px; color: #333; margin-bottom: 5px; font-weight: bold; }
        .cost-value { font-size: 24px; font-weight: bold; }
        .cost-breakdown { font-size: 13px; color: #666; margin-top: 8px; border-top: 1px dashed #ccc; padding-top: 8px; }
        .winner { background-color: #e8f5e9; border-color: #4caf50; }
        .winner .cost-value { color: #2e7d32; }
        .chart-container { position: relative; height: 300px; width: 100%; margin-top: 30px; }

        /* å…¬å¼å€åŸŸæ¨£å¼ */
        .formula-box { background: #f3f2f1; padding: 20px; border-radius: 6px; border-left: 4px solid #0078d4; font-family: 'Consolas', 'Courier New', Courier, monospace; font-size: 14px; }
        .formula-item { margin-bottom: 15px; }
        .formula-item strong { color: #0078d4; font-family: 'Segoe UI', sans-serif;}
        .host-formula { margin-left: 20px; border-left: 2px solid #ccc; padding-left: 15px; margin-top: 10px; }
        .host-formula div { margin-bottom: 4px; }
        .highlight-calc { background: #e1dfdd; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
    </style>
</head>
<body>

    <div class="header">
        <h2>Windows Server 2025 æˆæ¬Šè²»ç”¨è©¦ç®—å·¥å…·</h2>
    </div>

    <div class="container">
        <div class="panel">
            <h3>ç’°å¢ƒåƒæ•¸è¨­å®š</h3>
            <div class="form-group">
                <label for="total-users">å…¨ç’°å¢ƒä¸é‡è¤‡å­˜å–äººæ•¸ / è¨­å‚™æ•¸ (U<sub>total</sub>)</label>
                <input type="number" id="total-users" value="3000" min="0" oninput="calculateCosts()">
                <span class="hint">âš ï¸ åªè¦æœ‰ä½¿ç”¨åˆ° AD ç¶²åŸŸã€DHCPã€DNS æˆ–å­˜å–ä¼ºæœå™¨æª”æ¡ˆï¼Œçš†éœ€å…·å‚™ Windows Server CALã€‚</span>
            </div>
            
            <hr style="border: 0; border-top: 1px solid #eee; margin: 20px 0;">
            
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h3 style="margin: 0;">å¯¦é«”ä¸»æ©Ÿèˆ‡ VM é…ç½®</h3>
                <button onclick="addHost()">+ æ–°å¢å¯¦é«”ä¸»æ©Ÿ</button>
            </div>
            
            <div id="hosts-container">
                </div>
        </div>

        <div class="panel">
            <h3>è©¦ç®—çµæœåˆ†æ</h3>
            
            <div id="result-std" class="result-box">
                <div class="cost-title">æ–¹æ¡ˆ Aï¼šStandard (æ¨™æº–ç‰ˆ) ç¸½åƒ¹</div>
                <div class="cost-value" id="cost-std-val">NT$ 0</div>
                <div class="cost-breakdown" id="breakdown-std">ä¼ºæœå™¨æˆæ¬Š: 0 | CAL æˆæ¬Š: 0</div>
            </div>
            
            <div id="result-dc" class="result-box">
                <div class="cost-title">æ–¹æ¡ˆ Bï¼šDatacenter (è³‡æ–™ä¸­å¿ƒç‰ˆ) ç¸½åƒ¹</div>
                <div class="cost-value" id="cost-dc-val">NT$ 0</div>
                <div class="cost-breakdown" id="breakdown-dc">ä¼ºæœå™¨æˆæ¬Š: 0 | CAL æˆæ¬Š: 0</div>
            </div>

            <div class="chart-container">
                <canvas id="costChart"></canvas>
            </div>
        </div>

        <div class="panel full-width">
            <h3>ğŸ§® è²»ç”¨è¨ˆç®—å…¬å¼èˆ‡æ˜ç´° (å‹•æ…‹å¸¶å…¥)</h3>
            <div class="formula-box" id="dynamic-formula-box">
                </div>
        </div>
    </div>

    <script>
        // å®šåƒ¹å¸¸æ•¸ (æ–°å°å¹£ CSP åƒè€ƒå ±åƒ¹)
        const P_CAL = 1800; // Windows Server User CAL
        const P_STD_2CORE = 4800;  // Standard 2æ ¸å¿ƒåŒ…
        const P_DC_2CORE = 27600;  // Datacenter 2æ ¸å¿ƒåŒ…

        let hostCount = 0;
        let chartInstance = null;

        function initChart() {
            const ctx = document.getElementById('costChart').getContext('2d');
            chartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Standard (æ¨™æº–ç‰ˆ)', 'Datacenter (è³‡æ–™ä¸­å¿ƒç‰ˆ)'],
                    datasets: [{
                        label: 'é ä¼°ç¸½è²»ç”¨ (NT$)',
                        data: [0, 0],
                        backgroundColor: ['#0078d4', '#742774'],
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { y: { beginAtZero: true, ticks: { callback: function(value) { return 'NT$ ' + value.toLocaleString(); } } } },
                    plugins: { tooltip: { callbacks: { label: function(context) { return 'NT$ ' + context.raw.toLocaleString(); } } } }
                }
            });
        }

        function addHost() {
            hostCount++;
            const hostId = `host-${Date.now()}`;
            const hostHtml = `
                <div class="host-block" id="${hostId}" data-index="${hostCount}">
                    <div class="host-header">
                        <span>å¯¦é«”ä¸»æ©Ÿ #${hostCount}</span>
                        <button class="btn-remove" onclick="removeElement('${hostId}')">åˆªé™¤ä¸»æ©Ÿ</button>
                    </div>
                    <div class="host-inputs">
                        <div class="input-group">
                            <label>å¯¦é«” CPU æ•¸é‡</label>
                            <input type="number" class="cpu-count" value="2" min="1" oninput="calculateCosts()">
                        </div>
                        <div class="input-group">
                            <label>å¯¦é«”ç¸½æ ¸å¿ƒæ•¸</label>
                            <input type="number" class="core-count" value="16" min="1" oninput="calculateCosts()">
                        </div>
                        <div class="input-group">
                            <label>é è¨ˆé‹è¡Œ VM æ•¸</label>
                            <input type="number" class="vm-count" value="2" min="0" oninput="calculateCosts()">
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('hosts-container').insertAdjacentHTML('beforeend', hostHtml);
            calculateCosts();
        }

        function removeElement(elementId) {
            document.getElementById(elementId).remove();
            calculateCosts();
        }

        function calculateCosts() {
            const totalUsers = parseInt(document.getElementById('total-users').value) || 0;
            const hosts = document.querySelectorAll('.host-block');
            
            let totalStdServerCost = 0;
            let totalDcServerCost = 0;
            const calCost = totalUsers * P_CAL;

            let formulaHtml = ``;

            // 1. CAL è¨ˆç®—å…¬å¼
            formulaHtml += `
                <div class="formula-item">
                    <strong>1. CAL é€£ç·šæˆæ¬Šè²»ç”¨ï¼š</strong><br>
                    ${totalUsers} (äºº/è¨­å‚™) Ã— NT$ ${P_CAL.toLocaleString()} = <span class="highlight-calc">NT$ ${calCost.toLocaleString()}</span>
                </div>
                <div class="formula-item">
                    <strong>2. ä¼ºæœå™¨æ ¸å¿ƒæˆæ¬Šè²»ç”¨ (æŒ‰ä¸»æ©Ÿç¨ç«‹è¨ˆç®—)ï¼š</strong>
            `;

            let index = 1;
            hosts.forEach(host => {
                const cpus = parseInt(host.querySelector('.cpu-count').value) || 0;
                const cores = parseInt(host.querySelector('.core-count').value) || 0;
                const vms = parseInt(host.querySelector('.vm-count').value) || 0;

                // å¾®è»Ÿæ ¸å¿ƒè¨ˆç®—æ³•å‰‡
                let requiredCores = Math.max(16, cores, cpus * 8);
                let corePacks = Math.ceil(requiredCores / 2);

                // è¨ˆç®—ç–ŠåŠ å€æ•¸ (Stacking)
                let stdMultiplier = vms > 0 ? Math.ceil(vms / 2) : 1;
                
                let hostDcCost = corePacks * P_DC_2CORE;
                let hostStdCost = (corePacks * P_STD_2CORE) * stdMultiplier;

                totalDcServerCost += hostDcCost;
                totalStdServerCost += hostStdCost;

                formulaHtml += `
                    <div class="host-formula">
                        <strong style="color:#333;">å¯¦é«”ä¸»æ©Ÿ #${index}</strong>
                        <div>â€¢ åŸºæœ¬æ ¸å¿ƒæ•¸éœ€æ±‚ = Max(16, ${cores}æ ¸, ${cpus}é¡†CPU Ã— 8) = <strong>${requiredCores} æ ¸å¿ƒ</strong></div>
                        <div>â€¢ éœ€æ¡è³¼ 2æ ¸å¿ƒåŒ…æ•¸é‡ = ç„¡æ¢ä»¶é€²ä½( ${requiredCores} Ã· 2 ) = <strong>${corePacks} å¥—</strong></div>
                        <div style="margin-top: 8px; color: #742774;">â–¶ Datacenter æˆæœ¬ = ${corePacks} å¥— Ã— NT$ ${P_DC_2CORE.toLocaleString()} = <strong>NT$ ${hostDcCost.toLocaleString()}</strong> (å¯é–‹ç„¡é™å° VM)</div>
                        <div style="color: #0078d4;">â–¶ Standard æˆæœ¬ = ${corePacks} å¥— Ã— NT$ ${P_STD_2CORE.toLocaleString()} Ã— ç–ŠåŠ å€æ•¸ âŒˆ${vms}å°VM Ã· 2âŒ‰ = <strong>NT$ ${hostStdCost.toLocaleString()}</strong></div>
                    </div>
                `;
                index++;
            });

            formulaHtml += `</div><hr style="border: 0; border-top: 1px dashed #ccc; margin: 15px 0;">`;

            const totalStdCost = totalStdServerCost + calCost;
            const totalDcCost = totalDcServerCost + calCost;

            // ç¸½çµå…¬å¼
            formulaHtml += `
                <div class="formula-item">
                    <strong style="color: #742774;">ğŸ“Œ æ–¹æ¡ˆ Bï¼šDatacenter (è³‡æ–™ä¸­å¿ƒç‰ˆ) ç¸½æˆæœ¬</strong><br>
                    ä¼ºæœå™¨åŠ ç¸½ (NT$ ${totalDcServerCost.toLocaleString()}) + CALè²»ç”¨ (NT$ ${calCost.toLocaleString()}) = <span class="highlight-calc" style="color: #742774;">NT$ ${totalDcCost.toLocaleString()}</span>
                </div>
                <div class="formula-item">
                    <strong style="color: #0078d4;">ğŸ“Œ æ–¹æ¡ˆ Aï¼šStandard (æ¨™æº–ç‰ˆ) ç¸½æˆæœ¬</strong><br>
                    ä¼ºæœå™¨åŠ ç¸½ (NT$ ${totalStdServerCost.toLocaleString()}) + CALè²»ç”¨ (NT$ ${calCost.toLocaleString()}) = <span class="highlight-calc" style="color: #0078d4;">NT$ ${totalStdCost.toLocaleString()}</span>
                </div>
            `;

            document.getElementById('dynamic-formula-box').innerHTML = formulaHtml;

            // æ›´æ–°ç•«é¢ç¸½è¨ˆèˆ‡åœ–è¡¨
            document.getElementById('cost-std-val').innerText = `NT$ ${totalStdCost.toLocaleString()}`;
            document.getElementById('breakdown-std').innerText = `ä¼ºæœå™¨æˆæ¬Š: NT$ ${totalStdServerCost.toLocaleString()} | CAL æˆæ¬Š: NT$ ${calCost.toLocaleString()}`;
            
            document.getElementById('cost-dc-val').innerText = `NT$ ${totalDcCost.toLocaleString()}`;
            document.getElementById('breakdown-dc').innerText = `ä¼ºæœå™¨æˆæ¬Š: NT$ ${totalDcServerCost.toLocaleString()} | CAL æˆæ¬Š: NT$ ${calCost.toLocaleString()}`;

            // æ¨™è¨˜æœ€åˆ’ç®—æ–¹æ¡ˆ
            document.getElementById('result-std').classList.remove('winner');
            document.getElementById('result-dc').classList.remove('winner');
            
            if (hosts.length > 0 || totalUsers > 0) {
                if (totalStdCost <= totalDcCost) {
                    document.getElementById('result-std').classList.add('winner');
                } else {
                    document.getElementById('result-dc').classList.add('winner');
                }
            }

            if (chartInstance) {
                chartInstance.data.datasets[0].data = [totalStdCost, totalDcCost];
                chartInstance.update();
            }
        }

        window.onload = () => {
            initChart();
            addHost(); 
        };
    </script>
</body>
</html>